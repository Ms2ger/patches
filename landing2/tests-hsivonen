From: Ms2ger <ms2ger@gmail.com>

diff --git a/dom/imptests/css.mk b/dom/imptests/css.mk
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css.mk
@@ -0,0 +1,3 @@
+DIRS += \
+  css/contributors/opera/submitted/css3-syntax/charset \
+  $(NULL)
diff --git a/dom/imptests/css.txt b/dom/imptests/css.txt
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css.txt
@@ -0,0 +1,2 @@
+https://hg.csswg.org/test|css
+contributors/opera/submitted/css3-syntax/charset
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/Makefile.in b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/Makefile.in
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/Makefile.in
@@ -0,0 +1,38 @@
+# THIS FILE IS AUTOGENERATED BY importTestsuite.py - DO NOT EDIT
+
+DEPTH := @DEPTH@
+
+topsrcdir := @top_srcdir@
+srcdir := @srcdir@
+VPATH := @srcdir@
+relativesrcdir := @relativesrcdir@
+
+include $(DEPTH)/config/autoconf.mk
+
+DIRS := \
+  support \
+  $(NULL)
+
+MOCHITEST_FILES := \
+  test_page-utf16-css-bomless-utf16be.html \
+  test_page-utf16-css-bomless-utf16.html \
+  test_page-utf16-css-no-decl-ascii-only.html \
+  test_page-utf16-css-no-decl.html \
+  test_page-windows-1251-charset-attribute-bogus.html \
+  test_page-windows-1251-css-at-charset-1250-charset-attribute-windows-1253.html \
+  test_page-windows-1251-css-at-charset-bogus-charset-attribute-windows-1250.html \
+  test_page-windows-1251-css-at-charset-bogus.html \
+  test_page-windows-1251-css-at-charset-utf16-ascii-only.html \
+  test_page-windows-1251-css-at-charset-utf16be.html \
+  test_page-windows-1251-css-at-charset-utf16.html \
+  test_page-windows-1251-css-at-charset-windows-1250-in-utf16be.html \
+  test_page-windows-1251-css-at-charset-windows-1250-in-utf16.html \
+  test_page-windows-1251-css-http-bogus-at-charset-windows-1250.html \
+  test_page-windows-1251-css-http-bogus.html \
+  test_page-windows-1251-css-http-windows-1250-at-charset-windows-1253.html \
+  test_page-windows-1251-css-no-decl.html \
+  test_page-windows-1251-css-utf8-bom.html \
+  test_xml-stylesheet-page-windows-1251-charset-attribute-windows-1250.xhtml \
+  $(NULL)
+
+include $(topsrcdir)/config/rules.mk
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/Makefile.in b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/Makefile.in
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/Makefile.in
@@ -0,0 +1,33 @@
+# THIS FILE IS AUTOGENERATED BY importTestsuite.py - DO NOT EDIT
+
+DEPTH := @DEPTH@
+
+topsrcdir := @top_srcdir@
+srcdir := @srcdir@
+VPATH := @srcdir@
+relativesrcdir := @relativesrcdir@
+
+include $(DEPTH)/config/autoconf.mk
+
+DIRS := \
+  $(NULL)
+
+MOCHITEST_FILES := \
+  at-charset-bogus.css \
+  at-charset-utf16-ascii-only.css \
+  at-charset-utf16be.css \
+  at-charset-utf16.css \
+  at-charset-windows-1250.css \
+  at-charset-windows-1250-in-utf16be.css \
+  at-charset-windows-1250-in-utf16.css \
+  bomless-utf16be.css \
+  bomless-utf16.css \
+  http-bogus-at-charset-windows-1250.bogus.css \
+  http-bogus.bogus.css \
+  http-windows-1250-at-charset-windows-1253.windows1250.css \
+  no-decl-ascii-only.css \
+  no-decl.css \
+  utf8-bom.css \
+  $(NULL)
+
+include $(topsrcdir)/config/rules.mk
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/at-charset-bogus.css b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/at-charset-bogus.css
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/at-charset-bogus.css
@@ -0,0 +1,2 @@
+@charset "bogus";
+#È { visibility:hidden }
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/at-charset-utf16-ascii-only.css b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/at-charset-utf16-ascii-only.css
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/at-charset-utf16-ascii-only.css
@@ -0,0 +1,2 @@
+@charset "utf-16";
+#foo { visibility:hidden }
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/at-charset-utf16.css b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/at-charset-utf16.css
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/at-charset-utf16.css
@@ -0,0 +1,2 @@
+@charset "utf-16";
+#È { visibility:hidden }
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/at-charset-utf16be.css b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/at-charset-utf16be.css
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/at-charset-utf16be.css
@@ -0,0 +1,2 @@
+@charset "utf-16be";
+#È { visibility:hidden }
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/at-charset-windows-1250-in-utf16.css b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/at-charset-windows-1250-in-utf16.css
new file mode 100644
index 0000000000000000000000000000000000000000..1132bfd19380916ae44889d4e9b7e0f363a38d56
GIT binary patch
literal 77
zc${-!NM^`jNMtBtC}v1yC}B`wP+}-&$YjW4NMXnavWgjW84MYW7)%)qfHKw$Tou)|
dT*@aDsujvIi!+llb23XRtuiuGQd092Y5`LT5`O>y

diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/at-charset-windows-1250-in-utf16be.css b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/at-charset-windows-1250-in-utf16be.css
new file mode 100644
index 0000000000000000000000000000000000000000..38bb069784e0c9715c7b46fd1226f769333b2bf0
GIT binary patch
literal 77
zc${N!U`S@jU`S*rVkl-vWhh}#U{GQxXUJs8V@P4h2eOJ8bQug8j2KKA41hA$Tou)|
dT*@aDsujvIi!+llb23XRtuiuGQd092Y5_|?5`O>y

diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/at-charset-windows-1250.css b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/at-charset-windows-1250.css
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/at-charset-windows-1250.css
@@ -0,0 +1,2 @@
+@charset "windows-1250";
+#È { visibility:hidden }
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/bomless-utf16.css b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/bomless-utf16.css
new file mode 100644
index 0000000000000000000000000000000000000000..b5399b74bfb8d40cd854b7ba2c9122add3f0118b
GIT binary patch
literal 52
vc$`yaNMpzcLIs9uATDFbWGDvWBp}WK;u3~R1}laPAS(q3QyKDrYHAq({;mnG

diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/bomless-utf16be.css b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/bomless-utf16be.css
new file mode 100644
index 0000000000000000000000000000000000000000..eaadad0135507044c63d65ffb44d50b1b33e126d
GIT binary patch
literal 52
vc${NUW=Lbm2SNpgY9KCS$Ydx6;v^u>0pb#dN(L*23?M572vZsIfNE+1^#KX4

diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/http-bogus-at-charset-windows-1250.bogus.css b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/http-bogus-at-charset-windows-1250.bogus.css
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/http-bogus-at-charset-windows-1250.bogus.css
@@ -0,0 +1,2 @@
+@charset "windows-1250";
+#È { visibility:hidden }
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/http-bogus.bogus.css b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/http-bogus.bogus.css
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/http-bogus.bogus.css
@@ -0,0 +1,1 @@
+#È { visibility:hidden }
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/http-windows-1250-at-charset-windows-1253.windows1250.css b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/http-windows-1250-at-charset-windows-1253.windows1250.css
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/http-windows-1250-at-charset-windows-1253.windows1250.css
@@ -0,0 +1,2 @@
+@charset "windows-1253";
+#È { visibility:hidden }
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/no-decl-ascii-only.css b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/no-decl-ascii-only.css
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/no-decl-ascii-only.css
@@ -0,0 +1,1 @@
+#foo { visibility:hidden }
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/no-decl.css b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/no-decl.css
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/no-decl.css
@@ -0,0 +1,1 @@
+#È { visibility:hidden }
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/utf8-bom.css b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/utf8-bom.css
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/support/utf8-bom.css
@@ -0,0 +1,1 @@
+ï»¿#È { visibility:hidden }
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-utf16-css-bomless-utf16.html b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-utf16-css-bomless-utf16.html
new file mode 100644
index 0000000000000000000000000000000000000000..a9a289dc7c34ad91f04558614b2f3366231d269f
GIT binary patch
literal 1006
zc$}?MO;3YB5PfHV1@=-*ER7dqwDe%(!E=8=gDn)4mX)PV8slGA-^?zgU$+_pyF2sd
zz4=&ve@3{*0u|<Hu!BL006F(7lo;a*Bkl{nB|T$IFy#{vog+aFOKXEiS`5!ijo#3b
zVSqc_<Cf<(=8Y;V<*|GYaU%>5bVS!urKZi$8t_!}9HU2MtsE5@#3p-*mbLMDt-VTw
zcYb>(8ONRa1Jy)*U+w?&1!;(^>A57AlBYF37%Pk=W30~0bu;HT)hu)MXPT!auj$l>
zNBtjoRq1|2J*&AnwFT9-WGlFf8BuYvE;Hvjhsubm&Y+HK*=ps1R<Yt5^L6)c!*j|i
zrBh3-=S8z^t<S9YmDmt{uhz#6p7uB!&zDej$Cx>0-CRPCt!S5u5;8fo=vl=X;xpzU
zkzu!!dnr-E@I{8eE6DVuvoo%r#3tmmM7i82+HIp<PN_BR<`w$d<=^OQ4G}9S7+Y{g
ih0a>A&Yx?47utii-axa?H73&Tt(Dh#zx{f8ll}lfSFgqZ

diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-utf16-css-bomless-utf16be.html b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-utf16-css-bomless-utf16be.html
new file mode 100644
index 0000000000000000000000000000000000000000..584299b8f8eea4fd0ccfc82ba23affd649c4e6c7
GIT binary patch
literal 1016
zc$}?MO;3YB5PfHV1@=-*ER7dqwDe%(!E=8=Lt7{)Eh|f#G{(QKzL{One%v$!c4y|z
zdow%B*XIbASfauL4fZfd5g_M&jS^#AV8ngFw`63D38s7kqH`puVd-sfPmiI!((Elg
z83wq)Ev{*|IdiJ4mB;cq#Lej)VR)b=+LlT+eTLqER!uubkH}hiDzb=A_L41Y<7?Y^
zr3f$l_D-sfy9(~8ChEV{{!d?!hRB+cztmFF+TfMB!dNoL>df4U=KQ8wWv=l|>$K!G
zo%---1_Q6!P9UPD)%u*`l8QSr7Tm?msyJa+or|19WkgkHP{;l3wEI9iS#yo~x_h{#
zow8Fot(Erlq!qW`NA~<oY>2*B>*ER!zc?Gumr!-joCRjxY(kH%=$DQXGC8#9S;ZOR
zGu9!QVYidJDOtksPKLlM$OPqdXI$TiO~`ABa<xzN#EqVGO08)(v(Wc0|43hZh}c2F
j+=A06bl!q>@t=s~wjBprcdoHW&u^p5F8blu)BE%dwm7lY

diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-utf16-css-no-decl-ascii-only.html b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-utf16-css-no-decl-ascii-only.html
new file mode 100644
index 0000000000000000000000000000000000000000..032511e4cd94567c8254d66e2d3001c70d7f818c
GIT binary patch
literal 1008
zc$}@1%}&Bl5QWd$r>JhIiD29qqd=m>g=-(cp!^gqrS^geF}}L`&Gb@H+-XRA@64Q;
zbEY$Vymz&)krsN;QfrkOD^bRMu3UZXsmp!FlN0G{pj&<k=uAUZ3V4?~$5UcYJ$r>`
zqP9+Ssw3=8P60~-*O=^_TdGU^1KsdTh!uF(I)w4~8>eXq<W%@dya`r?-O~Zc3QQn-
z<vzPxww=qUv2ZJ>qetEcJL-Fl;xpKceVgt7_zhWttcd(YOO93OiCn9glM{S)x$|Va
z$F4H-_{4Pv>Xr@rvCpF2%%a0PxSpC}1j7pzX54zj7fiNRQ%8P7O+YPvLH*SK;@u{$
ze9qbPov{5|VUJN}UuWt)TzgL&?-f1XfKAnkY%R9sVyosd)*HgQCg(wS%`DQ0t@msJ
zW)#uJ7aUiDpP<7s)8=NoXjxX_l?q8@u!-5%yyJWZJEU#^RcjxRGpFLpE05Up&5Y96
tyZtv>-b05DX5`Lv&y)M^uVefxV!4}+6W5)2tmEIW@XB@cEuOpk^9i&ouWJAR

diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-utf16-css-no-decl.html b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-utf16-css-no-decl.html
new file mode 100644
index 0000000000000000000000000000000000000000..69d98790a48c931a494c2007eb2ee2de7109de0c
GIT binary patch
literal 998
zc$}@1xlY4C5QhJnr!XLqAQ2-Pgn&?hD5z<XP{@G|PGY<<B0{`6@Xh$(NIH;Z@9xZh
z%<Qf|-cPluk>(m|p`~(-6)9mpRi-m-=#+WNn~^!wg|2xb(1`{r6o@W#OeAN0@9dJu
zL_HnoP<yN!&J33buQBWl-TfcR<`l>j#B!n$tAcf3TObQC0e<N*n;YB4MP13vS3$8J
z_-?J#*l+7P!p+>jyZxWPA#;!gnZMMMv6|@-t|?}4f}c?4J_+BkSDAQz;&lde^VWUe
zcf8l`c+59=J(a@<hi4R0W_|K=&abMb%B(}}Xj?D1*)!6~8vO50p1tqLdzdoz{SMfD
zD_M`J(e~-yySeo4n&>&*UV-hZqZ`nTYe%~{e<?3&)dAj1m_yyRXVa~*bK=(F0Dgrw
z*WkDu`~-btcH5cVO=FqDD+*EVU?*t1d&~F)c7SdGRdsLyXNqF!$|LT5b7tLo2kejN
pcn>ihq;ON+@n-%nEbIJN#<)$#k=LDgF7{oVxpI|#tH;&*^a&PSt{?ya

diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-charset-attribute-bogus.html b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-charset-attribute-bogus.html
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-charset-attribute-bogus.html
@@ -0,0 +1,16 @@
+<!doctype html>
+<title>CSS charset: page windows-1251, charset attribute bogus</title>
+<meta charset=windows-1251>
+<script src="/resources/testharness.js"></script>
+<script src="/resources/testharnessreport.js"></script>
+<link rel=stylesheet href="support/no-decl.css" charset="bogus">
+<div id=log></div>
+<div id=&#x0418;></div>
+<script>
+var elm = document.getElementById('\u0418');
+var t = async_test();
+onload = t.step_func(function(){
+  assert_equals(getComputedStyle(elm, '').visibility, 'hidden');
+  this.done();
+});
+</script>
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-1250-charset-attribute-windows-1253.html b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-1250-charset-attribute-windows-1253.html
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-1250-charset-attribute-windows-1253.html
@@ -0,0 +1,16 @@
+<!doctype html>
+<title>CSS charset: page windows-1251, @charset windows-1250, charset attribute windows-1253</title>
+<meta charset=windows-1251>
+<script src="/resources/testharness.js"></script>
+<script src="/resources/testharnessreport.js"></script>
+<link rel=stylesheet href="support/at-charset-windows-1250.css" charset=windows-1253>
+<div id=log></div>
+<div id=&#x010C;></div>
+<script>
+var elm = document.getElementById('\u010C');
+var t = async_test();
+onload = t.step_func(function(){
+  assert_equals(getComputedStyle(elm, '').visibility, 'hidden');
+  this.done();
+});
+</script>
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-bogus-charset-attribute-windows-1250.html b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-bogus-charset-attribute-windows-1250.html
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-bogus-charset-attribute-windows-1250.html
@@ -0,0 +1,16 @@
+<!doctype html>
+<title>CSS charset: page windows-1251, CSS @charset bogus, charset attribute windows-1250</title>
+<meta charset=windows-1251>
+<script src="/resources/testharness.js"></script>
+<script src="/resources/testharnessreport.js"></script>
+<link rel=stylesheet href="support/at-charset-bogus.css" charset=windows-1250>
+<div id=log></div>
+<div id=&#x010C;></div>
+<script>
+var elm = document.getElementById('\u010C');
+var t = async_test();
+onload = t.step_func(function(){
+  assert_equals(getComputedStyle(elm, '').visibility, 'hidden');
+  this.done();
+});
+</script>
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-bogus.html b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-bogus.html
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-bogus.html
@@ -0,0 +1,16 @@
+<!doctype html>
+<title>CSS charset: page windows-1251, @charset bogus</title>
+<meta charset=windows-1251>
+<script src="/resources/testharness.js"></script>
+<script src="/resources/testharnessreport.js"></script>
+<link rel=stylesheet href="support/at-charset-bogus.css">
+<div id=log></div>
+<div id=&#x0418;></div>
+<script>
+var elm = document.getElementById('\u0418');
+var t = async_test();
+onload = t.step_func(function(){
+  assert_equals(getComputedStyle(elm, '').visibility, 'hidden');
+  this.done();
+});
+</script>
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-utf16-ascii-only.html b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-utf16-ascii-only.html
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-utf16-ascii-only.html
@@ -0,0 +1,16 @@
+<!doctype html>
+<title>CSS charset: page windows-1251, CSS @charset utf-16 (ASCII only)</title>
+<meta charset=windows-1251>
+<script src="/resources/testharness.js"></script>
+<script src="/resources/testharnessreport.js"></script>
+<link rel=stylesheet href="support/at-charset-utf16-ascii-only.css">
+<div id=log></div>
+<div id=foo></div>
+<script>
+var elm = document.getElementById('foo');
+var t = async_test();
+onload = t.step_func(function(){
+  assert_equals(getComputedStyle(elm, '').visibility, 'hidden');
+  this.done();
+});
+</script>
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-utf16.html b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-utf16.html
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-utf16.html
@@ -0,0 +1,16 @@
+<!doctype html>
+<title>CSS charset: page windows-1251, CSS @charset utf-16</title>
+<meta charset=windows-1251>
+<script src="/resources/testharness.js"></script>
+<script src="/resources/testharnessreport.js"></script>
+<link rel=stylesheet href="support/at-charset-utf16.css">
+<div id=log></div>
+<div id=&#xfffd;></div>
+<script>
+var elm = document.getElementById('\ufffd');
+var t = async_test();
+onload = t.step_func(function(){
+  assert_equals(getComputedStyle(elm, '').visibility, 'hidden');
+  this.done();
+});
+</script>
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-utf16be.html b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-utf16be.html
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-utf16be.html
@@ -0,0 +1,16 @@
+<!doctype html>
+<title>CSS charset: page windows-1251, CSS @charset utf-16be</title>
+<meta charset=windows-1251>
+<script src="/resources/testharness.js"></script>
+<script src="/resources/testharnessreport.js"></script>
+<link rel=stylesheet href="support/at-charset-utf16be.css">
+<div id=log></div>
+<div id=&#xfffd;></div>
+<script>
+var elm = document.getElementById('\ufffd');
+var t = async_test();
+onload = t.step_func(function(){
+  assert_equals(getComputedStyle(elm, '').visibility, 'hidden');
+  this.done();
+});
+</script>
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-windows-1250-in-utf16.html b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-windows-1250-in-utf16.html
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-windows-1250-in-utf16.html
@@ -0,0 +1,22 @@
+<!doctype html>
+<title>CSS charset: page windows-1251, CSS @charset windows-1250 in utf-16</title>
+<meta charset=windows-1251>
+<script src="/resources/testharness.js"></script>
+<script src="/resources/testharnessreport.js"></script>
+<link rel=stylesheet href="support/at-charset-windows-1250-in-utf16.css">
+<div id=log></div>
+<div id=&#xfffd;></div>
+<div id=&#x0418;></div>
+<div id=&#x010c;></div>
+<script>
+var elm_fffd = document.getElementById('\ufffd');
+var elm_0418 = document.getElementById('\u0418');
+var elm_010c = document.getElementById('\u010c');
+var t = async_test();
+onload = t.step_func(function(){
+  assert_equals(getComputedStyle(elm_fffd, '').visibility, 'visible', 'selector U+FFFD matched (utf-8)');
+  assert_equals(getComputedStyle(elm_0418, '').visibility, 'hidden', 'selector U+0418 did not match (windows-1251)');
+  assert_equals(getComputedStyle(elm_010c, '').visibility, 'visible', 'selector U+010C matched (windows-1250)');
+  this.done();
+});
+</script>
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-windows-1250-in-utf16be.html b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-windows-1250-in-utf16be.html
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-at-charset-windows-1250-in-utf16be.html
@@ -0,0 +1,22 @@
+<!doctype html>
+<title>CSS charset: page windows-1251, CSS @charset windows-1250 in utf-16be</title>
+<meta charset=windows-1251>
+<script src="/resources/testharness.js"></script>
+<script src="/resources/testharnessreport.js"></script>
+<link rel=stylesheet href="support/at-charset-windows-1250-in-utf16be.css">
+<div id=log></div>
+<div id=&#xfffd;></div>
+<div id=&#x0418;></div>
+<div id=&#x010c;></div>
+<script>
+var elm_fffd = document.getElementById('\ufffd');
+var elm_0418 = document.getElementById('\u0418');
+var elm_010c = document.getElementById('\u010c');
+var t = async_test();
+onload = t.step_func(function(){
+  assert_equals(getComputedStyle(elm_fffd, '').visibility, 'visible', 'selector U+FFFD matched (utf-8)');
+  assert_equals(getComputedStyle(elm_0418, '').visibility, 'hidden', 'selector U+0418 did not match (windows-1251)');
+  assert_equals(getComputedStyle(elm_010c, '').visibility, 'visible', 'selector U+010C matched (windows-1250)');
+  this.done();
+});
+</script>
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-http-bogus-at-charset-windows-1250.html b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-http-bogus-at-charset-windows-1250.html
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-http-bogus-at-charset-windows-1250.html
@@ -0,0 +1,16 @@
+<!doctype html>
+<title>CSS charset: page windows-1251, CSS HTTP bogus, @charset windows-1250</title>
+<meta charset=windows-1251>
+<script src="/resources/testharness.js"></script>
+<script src="/resources/testharnessreport.js"></script>
+<link rel=stylesheet href="support/http-bogus-at-charset-windows-1250.bogus.css">
+<div id=log></div>
+<div id=&#x010C;></div>
+<script>
+var elm = document.getElementById('\u010C');
+var t = async_test();
+onload = t.step_func(function(){
+  assert_equals(getComputedStyle(elm, '').visibility, 'hidden');
+  this.done();
+});
+</script>
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-http-bogus.html b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-http-bogus.html
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-http-bogus.html
@@ -0,0 +1,16 @@
+<!doctype html>
+<title>CSS charset: page windows-1251, CSS HTTP bogus</title>
+<meta charset=windows-1251>
+<script src="/resources/testharness.js"></script>
+<script src="/resources/testharnessreport.js"></script>
+<link rel=stylesheet href="support/http-bogus.bogus.css">
+<div id=log></div>
+<div id=&#x0418;></div>
+<script>
+var elm = document.getElementById('\u0418');
+var t = async_test();
+onload = t.step_func(function(){
+  assert_equals(getComputedStyle(elm, '').visibility, 'hidden');
+  this.done();
+});
+</script>
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-http-windows-1250-at-charset-windows-1253.html b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-http-windows-1250-at-charset-windows-1253.html
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-http-windows-1250-at-charset-windows-1253.html
@@ -0,0 +1,16 @@
+<!doctype html>
+<title>CSS charset: page windows-1251, CSS HTTP windows-1250, @charset windows-1253</title>
+<meta charset=windows-1251>
+<script src="/resources/testharness.js"></script>
+<script src="/resources/testharnessreport.js"></script>
+<link rel=stylesheet href="support/http-windows-1250-at-charset-windows-1253.windows1250.css">
+<div id=log></div>
+<div id=&#x010C;></div>
+<script>
+var elm = document.getElementById('\u010C');
+var t = async_test();
+onload = t.step_func(function(){
+  assert_equals(getComputedStyle(elm, '').visibility, 'hidden');
+  this.done();
+});
+</script>
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-no-decl.html b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-no-decl.html
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-no-decl.html
@@ -0,0 +1,16 @@
+<!doctype html>
+<title>CSS charset: page windows-1251, CSS no decl</title>
+<meta charset=windows-1251>
+<script src="/resources/testharness.js"></script>
+<script src="/resources/testharnessreport.js"></script>
+<link rel=stylesheet href="support/no-decl.css">
+<div id=log></div>
+<div id=&#x0418;></div>
+<script>
+var elm = document.getElementById('\u0418');
+var t = async_test();
+onload = t.step_func(function(){
+  assert_equals(getComputedStyle(elm, '').visibility, 'hidden');
+  this.done();
+});
+</script>
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-utf8-bom.html b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-utf8-bom.html
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_page-windows-1251-css-utf8-bom.html
@@ -0,0 +1,16 @@
+<!doctype html>
+<title>CSS charset: page windows-1251, CSS UTF-8 BOM</title>
+<meta charset=windows-1251>
+<script src="/resources/testharness.js"></script>
+<script src="/resources/testharnessreport.js"></script>
+<link rel=stylesheet href="support/utf8-bom.css">
+<div id=log></div>
+<div id=&#xfffd;></div>
+<script>
+var elm = document.getElementById('\ufffd');
+var t = async_test();
+onload = t.step_func(function(){
+  assert_equals(getComputedStyle(elm, '').visibility, 'hidden');
+  this.done();
+});
+</script>
\ No newline at end of file
diff --git a/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_xml-stylesheet-page-windows-1251-charset-attribute-windows-1250.xhtml b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_xml-stylesheet-page-windows-1251-charset-attribute-windows-1250.xhtml
new file mode 100644
--- /dev/null
+++ b/dom/imptests/css/contributors/opera/submitted/css3-syntax/charset/test_xml-stylesheet-page-windows-1251-charset-attribute-windows-1250.xhtml
@@ -0,0 +1,19 @@
+<?xml version="1.0" encoding="windows-1251"?>
+<?xml-stylesheet href="support/no-decl.css" charset="windows-1250"?>
+<html xmlns="http://www.w3.org/1999/xhtml"><head>
+<title>CSS charset: page windows-1251, charset attribute bogus</title>
+<script src="/resources/testharness.js"></script>
+<script src="/resources/testharnessreport.js"></script>
+</head><body>
+<div id="log"></div>
+<div id="foo"></div>
+<script>
+var elm = document.getElementById('foo');
+elm.id = '\u010C';
+var t = async_test();
+onload = t.step_func(function(){
+  assert_equals(getComputedStyle(elm, '').visibility, 'hidden');
+  this.done();
+});
+</script>
+</body></html>
\ No newline at end of file
